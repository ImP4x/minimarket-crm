{% extends "base.html" %}
{% block title %}Reporte de Ventas{% endblock %}
{% block content %}

<div class="fade-in">
    <h1 class="section-title">📊 Reporte de Ventas</h1>
    <h3 style="text-align: center; color: #666; margin-bottom: 30px;">
        {{ titulo_periodo }} ({{ fecha_inicio }} - {{ fecha_fin }})
    </h3>

    <!-- Filtros de periodo -->
    <div class="form-card" style="margin-bottom: 30px;">
        <h3>🔍 Filtrar por periodo:</h3>
        <div class="action-buttons" style="justify-content: center;">
            <form method="GET" action="{{ url_for('ventas.reporte_ventas') }}" style="display: inline;">
                <button type="submit" name="periodo" value="semanal" 
                        class="btn {{ 'btn-primary' if periodo_actual == 'semanal' else 'btn-secondary' }}">
                    📅 Semanal
                </button>
            </form>
            
            <form method="GET" action="{{ url_for('ventas.reporte_ventas') }}" style="display: inline;">
                <button type="submit" name="periodo" value="mensual" 
                        class="btn {{ 'btn-primary' if periodo_actual == 'mensual' else 'btn-secondary' }}">
                    📅 Mensual
                </button>
            </form>
            
            <form method="GET" action="{{ url_for('ventas.reporte_ventas') }}" style="display: inline;">
                <button type="submit" name="periodo" value="anual" 
                        class="btn {{ 'btn-primary' if periodo_actual == 'anual' else 'btn-secondary' }}">
                    📅 Anual
                </button>
            </form>
        </div>
    </div>

    <!-- Estadísticas generales -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="form-card" style="text-align: center; background: linear-gradient(135deg, #e8f5e8, #c8e6c9);">
            <h3 style="color: #2e7d2e; margin-bottom: 10px;">💰 Total de Ventas</h3>
            <p style="font-size: 28px; font-weight: bold; margin: 0; color: #1b5e20;">
                ${{ "{:,.2f}".format(estadisticas.total_ventas) }}
            </p>
        </div>
        
        <div class="form-card" style="text-align: center; background: linear-gradient(135deg, #e3f2fd, #bbdefb);">
            <h3 style="color: #1976d2; margin-bottom: 10px;">📦 Transacciones</h3>
            <p style="font-size: 28px; font-weight: bold; margin: 0; color: #0d47a1;">
                {{ estadisticas.cantidad_transacciones }}
            </p>
        </div>
        
        <div class="form-card" style="text-align: center; background: linear-gradient(135deg, #fff3e0, #ffcc02);">
            <h3 style="color: #f57c00; margin-bottom: 10px;">📈 Promedio por Venta</h3>
            <p style="font-size: 28px; font-weight: bold; margin: 0; color: #e65100;">
                ${{ "{:,.2f}".format(estadisticas.promedio_venta) }}
            </p>
        </div>
    </div>

    <!-- Tabla detallada de ventas -->
    <div class="form-card">
        <h3>📋 Detalle de Ventas</h3>
        {% if ventas_detalladas %}
        <div style="overflow-x: auto;">
            <table class="table">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Cliente</th>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Total</th>
                        <th>Vendedor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for venta in ventas_detalladas %}
                    <tr>
                        <td>{{ venta.fecha.strftime('%d/%m/%Y %H:%M') }}</td>
                        <td>{{ venta.cliente_nombre }}</td>
                        <td>{{ venta.producto_nombre }}</td>
                        <td style="text-align: center;">{{ venta.cantidad }}</td>
                        <td style="text-align: right; font-weight: bold;">${{ "{:,.2f}".format(venta.total) }}</td>
                        <td>{{ venta.vendedor }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 40px; background: #f5f5f5; border-radius: 8px; border: 2px dashed #ccc;">
            <p style="font-size: 18px; color: #666; margin: 0;">
                📭 No hay ventas registradas en este periodo
            </p>
            <p style="color: #999; margin-top: 10px;">
                Selecciona un periodo diferente o registra algunas ventas
            </p>
        </div>
        {% endif %}
    </div>

    <!-- Enlaces de navegación -->
    <div style="text-align: center; margin-top: 30px;">
        <a href="{{ url_for('ventas.ventas') }}" class="btn btn-secondary">⬅ Volver a Registro de Ventas</a>
        <a href="{{ url_for('auth.dashboard_admin') if session['usuario']['rol'] == 'administrador' else url_for('auth.dashboard_vendedor') }}" 
           class="btn btn-primary" style="margin-left: 15px;">🏠 Dashboard Principal</a>
    </div>
</div>

{% endblock %}
